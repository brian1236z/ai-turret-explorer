<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">AI Turret Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4;
            color: #343a40;
            padding-top: 64px; 
        }
        .nav-link {
            @apply px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-white hover:bg-blue-600 transition-colors;
        }
        .nav-link.active {
            @apply bg-blue-700 text-white;
        }
        /* New mobile nav link style */
        .mobile-nav-link {
            @apply block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-white hover:bg-blue-600 transition-colors;
        }
        
        .lang-btn {
            @apply px-3 py-1 rounded-md text-sm font-medium transition-colors;
        }
        .lang-btn.active {
            @apply bg-blue-700 text-white;
        }
        .lang-btn:not(.active) {
            @apply text-gray-500 hover:bg-gray-200;
        }
        .content-section {
            @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16;
        }

        /* NEW KEYFRAMES */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .build-button {
            @apply w-full text-left p-6 bg-white rounded-lg shadow-lg flex items-center space-x-4 transition-all duration-300 transform;
            /* Apply the animation */
            animation: float 6s ease-in-out infinite;
        }
        
        /* Stagger animations for a 'cloudy' effect */
        #tab-btn-electronics { animation-delay: -3s; }
        #tab-btn-calibration { animation-delay: -1.5s; }
        #tab-btn-ai { animation-delay: -4.5s; }


        .build-button.active {
            @apply ring-4 ring-blue-500 ring-opacity-75 scale-105 bg-blue-50;
            animation-play-state: paused; /* Stop floating when active */
            transform: scale(1.05); /* Keep scale */
        }
        .build-button:not(.active) {
            @apply hover:bg-gray-50;
        }

        /* Stop float on hover and scale up */
        .build-button:hover:not(.active) {
            animation-play-state: paused;
            transform: scale(1.05);
            @apply shadow-xl;
        }
        
        .build-icon {
            @apply text-5xl text-blue-600 w-12;
        }
        .tab-content {
            @apply bg-white p-6 rounded-b-lg rounded-tr-lg shadow-md mt-6;
        }
        
        /* REMOVED .overview-card styles */
        
        .overview-content {
             @apply bg-white p-6 rounded-lg shadow-xl max-w-3xl mx-auto mt-6;
        }

        /* NEW styles for System Architecture clouds */
        .overview-cloud-wrapper {
            background: linear-gradient(135deg, rgba(147, 197, 253, 0.7), rgba(96, 165, 250, 0.7)); /* Soft blue gradient */
            border-radius: 50% 30% 50% 30% / 30% 50% 30% 50%; /* Cloud shape */
            padding: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease-in-out;
            animation: float 6s ease-in-out infinite; /* Keep the floating animation */
            cursor: pointer;
            display: flex; /* Ensure content is centered */
            justify-content: center;
            align-items: center;
            text-align: center;
            width: 280px; /* Set a fixed width */
            height: 280px; /* Set a fixed height */
        }
        .overview-cloud-wrapper:hover {
            transform: translateY(-15px) scale(1.08); /* Lift and scale more on hover */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation-play-state: paused; /* Stop floating on hover */
        }
        /* Stagger animations for overview clouds */
        #cloud-perception { animation-delay: -1s; }
        #cloud-decision { animation-delay: -3s; }
        #cloud-actuation { animation-delay: -5s; }

        .overview-button {
            @apply flex flex-col items-center justify-center p-4 bg-white bg-opacity-80 rounded-full shadow-inner; /* Inner white circle */
            color: #1e40af; /* Darker blue text */
            transition: all 0.3s ease-in-out;
            width: 100%; 
            height: 100%; 
            aspect-ratio: 1/1; 
        }
        .overview-button:hover {
            @apply bg-blue-50;
            color: #1c3580;
        }
        .overview-button.active .overview-text-title {
            color: #000; /* Darken text when active */
        }
        .overview-button.active .overview-text-description {
            color: #333; /* Darken text when active */
        }
        
        .overview-cloud-wrapper.active {
             animation-play-state: paused; /* Stop floating when active */
             transform: translateY(0px) scale(1.08);
        }

        .overview-icon-inner {
            @apply text-5xl;
            color: #2563eb; /* Blue icon color */
        }
        .overview-text-title {
            @apply text-xl font-semibold mt-2;
            color: #1e40af; /* Primary blue for title */
        }
        .overview-text-description {
            @apply text-sm text-gray-700 mt-1;
            color: #4a5568; /* Sub-text color */
        }
        /* END of new styles */


        .component-card {
            @apply bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300;
        }
        .category-button {
            @apply px-4 py-2 text-sm font-medium rounded-full cursor-pointer transition-all;
        }
        .category-button.active {
            @apply bg-blue-700 text-white shadow-lg;
        }
        .category-button:not(.active) {
            @apply bg-white text-blue-700 hover:bg-blue-100 shadow;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        model-viewer {
            width: 100%;
            height: 600px;
            background-color: #f8f7f4;
            --poster-color: #f8f7f4;
        }

        /* Custom Cloud-like Button Styles */
        .cloud-button-wrapper {
            background: linear-gradient(135deg, rgba(147, 197, 253, 0.7), rgba(96, 165, 250, 0.7)); /* Soft blue gradient */
            border-radius: 50% 30% 50% 30% / 30% 50% 30% 50%; /* Cloud shape */
            padding: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease-in-out;
            animation: float 6s ease-in-out infinite; /* Keep the floating animation */
            cursor: pointer;
            display: flex; /* Ensure content is centered */
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .cloud-button-wrapper:hover {
            transform: translateY(-15px) scale(1.08); /* Lift and scale more on hover */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation-play-state: paused; /* Stop floating on hover */
        }

        /* Adjust individual button delays to maintain cloudy movement */
        #cloud-mech { animation-delay: -2s; }
        #cloud-elec { animation-delay: -4.5s; }
        #cloud-ai { animation-delay: -1.0s; }
        #cloud-calib { animation-delay: -3.5s; }

        .cloud-button {
            @apply flex flex-col items-center justify-center p-4 bg-white bg-opacity-80 rounded-full shadow-inner; /* Inner white circle */
            color: #1e40af; /* Darker blue text */
            transition: all 0.3s ease-in-out;
            width: 100%; /* Make inner button take full width of cloud wrapper */
            height: 100%; /* Make inner button take full height of cloud wrapper */
            aspect-ratio: 1/1; /* Ensure circular shape for inner button */
        }
        .cloud-button:hover {
            @apply bg-blue-50;
            color: #1c3580;
        }
        .cloud-button.active .cloud-text-title {
            color: #000; /* Darken text when active */
        }
        .cloud-button.active .cloud-text-description {
            color: #333; /* Darken text when active */
        }

        .cloud-text-title {
            @apply text-xl font-semibold mt-2;
            color: #1e40af; /* Primary blue for title */
        }
        .cloud-text-description {
            @apply text-sm text-gray-700 mt-1;
            color: #4a5568; /* Sub-text color */
        }
        .cloud-icon {
            @apply text-5xl;
            color: #2563eb; /* Blue icon color */
        }
    </style>
</head>
<body class="antialiased">

    <nav class="bg-white shadow-sm fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex-shrink-0 flex items-center">
                    <span class="text-2xl font-bold text-blue-700" data-lang-key="nav_title">AI Turret Explorer</span>
                </div>
                
                <!-- Desktop Nav -->
                <div class="hidden sm:flex sm:items-center sm:space-x-4">
                    <div class="flex space-x-4">
                        <a href="#home" class="nav-link" data-lang-key="nav_home">Home</a>
                        <a href="#turret-3d" class="nav-link" data-lang-key="nav_3d">3D Turret View</a>
                        <a href="#overview" class="nav-link" data-lang-key="nav_overview">System Overview</a>
                        <a href="#components" class="nav-link" data-lang-key="nav_components">Components</a>
                        <a href="#build" class="nav-link" data-lang-key="nav_build">Build Guides</a>
                        <a href="#safety" class="nav-link" data-lang-key="nav_safety">Safety</a>
                    </div>
                    
                    <!-- Language Switcher (Desktop) -->
                    <div class="relative inline-block text-left ml-4 pl-4 border-l border-gray-200">
                        <button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-blue-600 text-sm font-medium text-white hover:bg-blue-700" id="lang-toggle-btn">
                            <span id="lang-btn-text">Language</span>
                            <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="lang-dropdown" class="origin-top-right absolute right-0 mt-2 w-40 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden z-50">
                            <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="lang-toggle-btn">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem" data-lang="en">English (EN)</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem" data-lang="zh-tw">繁體中文 (ZH-TW)</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Menu Button -->
                <div class="sm:hidden flex items-center">
                    <button id="mobile-menu-btn" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white">
                        <span class="sr-only">Open main menu</span>
                        <!-- Hamburger Icon -->
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <!-- Close Icon (hidden by default) -->
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu (hidden by default) -->
        <div id="mobile-menu" class="hidden sm:hidden bg-white shadow-lg">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="#home" class="mobile-nav-link" data-lang-key="nav_home">Home</a>
                <a href="#turret-3d" class="mobile-nav-link" data-lang-key="nav_3d">3D Turret View</a>
                <a href="#overview" class="mobile-nav-link" data-lang-key="nav_overview">System Overview</a>
                <a href="#components" class="mobile-nav-link" data-lang-key="nav_components">Components</a>
                <a href="#build" class="mobile-nav-link" data-lang-key="nav_build">Build Guides</a>
                <a href="#safety" class="mobile-nav-link" data-lang-key="nav_safety">Safety</a>
            </div>
            <!-- Language Switcher (Mobile) -->
            <div class="pt-4 pb-3 border-t border-gray-200">
                <div class="px-4">
                    <p class="text-sm font-medium text-gray-500" data-lang-key="nav_lang_title">Language</p>
                    <div class="mt-2 space-y-1">
                        <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100" data-lang="en">English (EN)</a>
                        <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100" data-lang="zh-tw">繁體中文 (ZH-TW)</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <section id="home" class="content-section bg-white shadow-inner">
            <div class="text-center">
                <h1 class="text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl" data-lang-key="home_title">AI-Powered Autonomous Turret</h1>
                <p class="mt-6 text-xl leading-8 text-gray-700 max-w-3xl mx-auto" data-lang-key="home_subtitle">An interactive guide to the construction and programming of an intelligent, non-lethal wildlife deterrent. This system is designed to identify and discourage specific animals from protected areas while actively detecting and avoiding human presence.</p>
                <div class="mt-10 flex items-center justify-center gap-x-6">
                    <a href="#overview" class="rounded-md bg-gradient-to-r from-blue-600 to-blue-700 px-5 py-3 text-lg font-semibold text-white shadow-md hover:shadow-lg hover:scale-105 transition-all transform" data-lang-key="home_explore_btn">Explore the System</a>
                </div>
            </div>
            <div class="mt-16 max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                <div class="bg-gray-50 p-6 rounded-lg shadow-md">
                    <span class="text-6xl" role="img" aria-label="macaque">🐵</span>
                    <h3 class="mt-4 text-lg font-semibold" data-lang-key="home_target1_title">Target: Macaque</h3>
                    <p class="text-gray-600" data-lang-key="home_target1_desc">Formosan Macaque (*Macaca cyclopis*)</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg shadow-md">
                    <span class="text-6xl" role="img" aria-label="deer">🦌</span>
                    <h3 class="mt-4 text-lg font-semibold" data-lang-key="home_target2_title">Target: Muntjac</h3>
                    <p class="text-gray-600" data-lang-key="home_target2_desc">Reeves's Muntjac (*Muntiacus reevesi*)</p>
                </div>
                <div class="bg-red-50 p-6 rounded-lg shadow-md border-2 border-red-300">
                    <span class="text-6xl" role="img" aria-label="person">👤</span>
                    <h3 class="mt-4 text-lg font-semibold text-red-800" data-lang-key="home_avoid_title">Avoid: Human</h3>
                    <p class="text-red-700" data-lang-key="home_avoid_desc">System enters safe mode on human detection.</p>
                </div>
            </div>
        </section>

        

<section id="turret-3d" class="content-section bg-gray-100 shadow-inner">
            <h2 class="text-3xl font-bold text-center mb-4" data-lang-key="3d_title">Interactive 3D Turret View</h2>
            <p class="text-lg text-gray-700 text-center max-w-3xl mx-auto mb-12" data-lang-key="3d_subtitle">Explore the AI Turret from every angle! Use your mouse/finger to rotate, pan, and zoom the model. This interactive view allows you to inspect the mechanical and electronic components in detail.</p>
            <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden">
                

<model-viewer 
                    src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
                    poster="https://modelviewer.dev/shared-assets/models/Astronaut.webp"
                    alt="Interactive 3D model of the AI Turret (using a placeholder Astronaut)" 
                    ar 
                    ar-modes="webxr scene-viewer quick-look" 
                    camera-controls 
                    touch-action="pan-y"
                    auto-rotate
                    shadow-intensity="1"
                    environment-image="neutral">
                    <div class="progress-bar hide" slot="progress-bar">
                        <div class="update-bar"></div>
                    </div>
                </model-viewer>
                <div class="p-6 text-center text-gray-600 text-sm">
                    <p data-lang-key="3d_note1">
                        <strong>Note:</strong> This is an interactive 3D model viewer. It is currently displaying a placeholder "Astronaut" model.
                    </p>
                    <p class="mt-2 text-blue-700" data-lang-key="3d_note2">
                        To show your own model, replace the `src` URL in the HTML with a public link to your own `.glb` or `.gltf` file.
                    </p>
                </div>
            </div>
        </section>
        

<section id="overview" class="content-section">
            <h2 class="text-3xl font-bold text-center mb-4" data-lang-key="overview_title">System Architecture</h2>
            <p class="text-lg text-gray-700 text-center max-w-3xl mx-auto mb-12" data-lang-key="overview_subtitle">The turret operates on a classic "Perception-Decision-Actuation" loop. This model explains how the components work together in real-time. Click a cloud to learn more about its function and key components.</p>
            
            <div class="flex flex-col md:flex-row items-center justify-center gap-8 mb-8">
                
                <div id="cloud-perception" class="overview-cloud-wrapper" data-overview="perception">
                    <button class="overview-button" id="btn-perception">
                        <span class="overview-icon-inner" role="img" aria-label="eye">👁️</span>
                        <h3 class="overview-text-title" data-lang-key="overview_btn1_title">1. Perception</h3>
                        <p class="overview-text-description" data-lang-key="overview_btn1_desc">Sensing the environment.</p>
                    </button>
                </div>
                
                <div id="cloud-decision" class="overview-cloud-wrapper" data-overview="decision">
                     <button class="overview-button" id="btn-decision">
                        <span class="overview-icon-inner" role="img" aria-label="brain">🧠</span>
                        <h3 class="overview-text-title" data-lang-key="overview_btn2_title">2. Decision</h3>
                        <p class="overview-text-description" data-lang-key="overview_btn2_desc">Analyzing and planning.</p>
                    </button>
                </div>
                
                <div id="cloud-actuation" class="overview-cloud-wrapper" data-overview="actuation">
                     <button class="overview-button" id="btn-actuation">
                        <span class="overview-icon-inner" role="img" aria-label="gear">⚙️</span>
                        <h3 class="overview-text-title" data-lang-key="overview_btn3_title">3. Actuation</h3>
                        <p class="overview-text-description" data-lang-key="overview_btn3_desc">Taking physical action.</p>
                    </button>
                </div>
            </div>

            <div id="content-perception" class="overview-content hidden">
                <h3 class="text-2xl font-semibold text-blue-700 mb-3" data-lang-key="overview_content1_title">Perception: The 360° Vision System</h3>
                <p class="text-gray-700" data-lang-key="overview_content1_desc">The system perceives its environment using a quad-camera array (4x Logitech C615 webcams) providing a seamless 360-degree panoramic view. This continuous stream of visual data is the primary sensory input, fed directly to the AI model for analysis. This setup eliminates blind spots and ensures comprehensive situational awareness.</p>
            </div>
            
            <div id="content-decision" class="overview-content hidden">
                <h3 class="text-2xl font-semibold text-blue-700 mb-3" data-lang-key="overview_content2_title">Decision: The AI Brain (Jetson & YOLO)</h3>
                <p class="text-gray-700" data-lang-key="overview_content2_desc">The heart of the decision-making process is the NVIDIA Jetson Orin Nano. It runs a custom-trained YOLO model, processing all camera feeds in real-time. This model detects and classifies objects (macaque, muntjac, human). The control software applies a simple logic: if a human is seen, enter "Safe Mode." If a target animal is seen (and no human), calculate its position and initiate tracking.</p>
            </div>
            
            <div id="content-actuation" class="overview-content hidden">
                <h3 class="text-2xl font-semibold text-blue-700 mb-3" data-lang-key="overview_content3_title">Actuation: The Mechanical Response</h3>
                <p class="text-gray-700" data-lang-key="overview_content3_desc">Based on the AI's decision, the Jetson commands the physical hardware. It sends signals to two NEMA 23 stepper motors via DM542S drivers, which move the high-torque herringbone gear pan-tilt mechanism to aim the paintball gun. To fire, it sends a signal to a relay, which activates a 24V solenoid to pull the trigger. This entire loop repeats multiple times per second.</p>
            </div>
        </section>

        <section id="components" class="content-section">
            <h2 class="text-3xl font-bold text-center mb-4" data-lang-key="components_title">Interactive Bill of Materials</h2>
            <p class="text-lg text-gray-700 text-center max-w-3xl mx-auto mb-12" data-lang-key="components_subtitle">This is the complete list of components required for the project. Use the filters to explore parts by category or use the search bar to find a specific item. A breakdown of component categories is shown in the chart.</p>
            
            <div class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/3">
                    <h3 class="text-2xl font-semibold text-center mb-4" data-lang-key="components_chart_title">Component Categories</h3>
                    <div class="chart-container">
                        <canvas id="bomChart"></canvas>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-center mb-4 mt-12" data-lang-key="components_software_title">Key Software Stack</h3>
                    <div class="space-y-3">
                        <div class="p-4 bg-white rounded-lg shadow-md">
                            <h4 class="font-semibold text-blue-800" data-lang-key="components_sw1_title">Operating System</h4>
                            <p class="text-sm text-gray-700" data-lang-key="components_sw1_desc">NVIDIA JetPack SDK (on Jetson)</p>
                            <p class="text-xs text-gray-500" data-lang-key="components_sw1_notes">Includes Ubuntu, CUDA, cuDNN, and TensorRT.</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow-md">
                            <h4 class="font-semibold text-blue-800" data-lang-key="components_sw2_title">Core Language</h4>
                            <p class="text-sm text-gray-700" data-lang-key="components_sw2_desc">Python 3.x</p>
                            <p class="text-xs text-gray-500" data-lang-key="components_sw2_notes">For the main control script, inference, and hardware I/O.</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow-md">
                            <h4 class="font-semibold text-blue-800" data-lang-key="components_sw3_title">AI / Object Detection</h4>
                            <p class="text-sm text-gray-700" data-lang-key="components_sw3_desc">Ultralytics YOLO (v11 cited, v8+ common)</p>
                            <p class="text-xs text-gray-500" data-lang-key="components_sw3_notes">Used for training and running the detection model.</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow-md">
                            <h4 class="font-semibold text-blue-800" data-lang-key="components_sw4_title">Key Libraries</h4>
                            <p class="text-sm text-gray-700" data-lang-key="components_sw4_desc">OpenCV, TensorRT, RPi.GPIO (or similar)</p>
                            <p class="text-xs text-gray-500" data-lang-key="components_sw4_notes">For camera vision, model acceleration, and motor control.</p>
                        </div>
                    </div>
                </div>
                
                <div class="w-full md:w-2/3">
                    <div class="mb-4">
                        <input type="text" id="searchInput" class="w-full px-4 py-3 rounded-lg shadow-inner border border-gray-300" placeholder="Search for a component (e.g., 'Jetson', 'NEMA 23')..." data-lang-key="components_search_placeholder">
                    </div>
                    <div id="category-filters" class="flex flex-wrap gap-2 mb-6">
                    </div>
                    
                    <div id="component-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto pr-2">
                    </div>
                </div>
            </div>
        </section>

        <section id="build" class="content-section bg-gray-100 shadow-inner">
            <h2 class="text-3xl font-bold text-center mb-12" data-lang-key="build_title">Interactive Build Guides</h2>
            <p class="text-lg text-gray-700 text-center max-w-3xl mx-auto mb-12" data-lang-key="build_subtitle">Explore the four core phases of building this AI Turret. Click on any cloud below to reveal detailed steps, challenges, and insights for that stage of development.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 justify-items-center">
                
                <!-- Mechanical Assembly Cloud Button --><div id="cloud-mech" class="cloud-button-wrapper" data-tab="mechanical">
                    <button class="cloud-button" id="tab-btn-mechanical">
                        <span class="cloud-icon" role="img" aria-label="gears">🔩</span>
                        <h3 class="cloud-text-title" data-lang-key="build_btn1_title">Mechanical Assembly</h3>
                        <p class="cloud-text-description" data-lang-key="build_btn1_desc">Physical frame & motion system</p>
                    </button>
                </div>
                
                <!-- Electronics & Wiring Cloud Button --><div id="cloud-elec" class="cloud-button-wrapper" data-tab="electronics">
                    <button class="cloud-button" id="tab-btn-electronics">
                        <span class="cloud-icon" role="img" aria-label="circuit">⚡</span>
                        <h3 class="cloud-text-title" data-lang-key="build_btn2_title">Electronics & Wiring</h3>
                        <p class="cloud-text-description" data-lang-key="build_btn2_desc">Power, logic & control components</p>
                    </button>
                </div>
                
                <!-- AI Model & Software Cloud Button --><div id="cloud-ai" class="cloud-button-wrapper" data-tab="ai">
                    <button class="cloud-button" id="tab-btn-ai">
                        <span class="cloud-icon" role="img" aria-label="brain">🧠</span>
                        <h3 class="cloud-text-title" data-lang-key="build_btn3_title">AI Model & Software</h3>
                        <p class="cloud-text-description" data-lang-key="build_btn3_desc">Training vision & control script</p>
                    </button>
                </div>
                
                <!-- Calibration & Testing Cloud Button --><div id="cloud-calib" class="cloud-button-wrapper" data-tab="calibration">
                    <button class="cloud-button" id="tab-btn-calibration">
                        <span class="cloud-icon" role="img" aria-label="target">🎯</span>
                        <h3 class="cloud-text-title" data-lang-key="build_btn4_title">Calibration & Testing</h3>
                        <p class="cloud-text-description" data-lang-key="build_btn4_desc">Aligning vision & hardware</p>
                    </button>
                </div>
            </div>

            <!-- Collapsible content sections --><div id="tab-content-mechanical" class="tab-content hidden">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4" data-lang-key="build_content1_title">Phase 1: Mechanical Assembly</h3>
                <p class="mb-6 text-gray-700" data-lang-key="build_content1_desc">This phase involves building the physical structure and motion system. Precision and rigidity are the primary goals. The core of this phase is the high-torque herringbone gear drive, which provides backlash-free, precise aiming.</p>
                <ul class="space-y-4">
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content1_step1_title">1. Construct the Main Frame</h4>
                        <p class="text-gray-600" data-lang-key="build_content1_step1_desc">Assemble the 2020 aluminum extrusion base and gantry. Use corner brackets and T-nuts to create a rigid skeleton, ensuring all corners are perfectly square.</p>
                    </li>
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content1_step2_title">2. Fabricate & Assemble Pan-Tilt Drive</h4>
                        <p class="text-gray-600" data-lang-key="build_content1_step2_desc">3D print the large herringbone gears (pan and tilt) and motor pinions from PETG or ABS. Mount the pan motor inside the frame, meshing with the main ring gear which sits on a thrust bearing. Assemble the tilt gantry with its motor and gear, supported by deep groove ball bearings.</p>
                    </li>
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content1_step3_title">3. Mount Payload & Vision System</h4>
                        <p class="text-gray-600" data-lang-key="build_content1_step3_desc">Secure the paintball gun in its 3D printed cradle. Install the 24V solenoid using a custom bracket, aligning it perfectly with the trigger. Mount the four webcams on the stationary base frame to create the overlapping 360° field of view.</p>
                    </li>
                </ul>
            </div>

            <div id="tab-content-electronics" class="tab-content hidden">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4" data-lang-key="build_content2_title">Phase 2: Electronics & Wiring</h3>
                <p class="mb-6 text-gray-700" data-lang-key="build_content2_desc">This phase connects all components, distributing power and control signals. A clean, methodical wiring plan with proper grounding is essential to prevent electrical noise from interfering with the Jetson's logic signals.</p>
                <ul class="space-y-4">
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content2_step1_title">1. Power Distribution</h4>
                        <p class="text-gray-600" data-lang-key="build_content2_step1_desc">Install the 12V Mean Well PSU. Use a terminal block to distribute 12V power to the Jetson, motor drivers, and two DC-DC converters. One buck converter steps 12V down to 5V (for logic), and one boost converter steps 12V up to 24V (for the solenoid).</p>
                    </li>
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content2_step2_title">2. Motion Control Wiring</h4>
                        <p class="text-gray-600" data-lang-key="build_content2_step2_desc">Connect the Jetson's GPIO pins to the `PUL+` (Pulse) and `DIR+` (Direction) inputs on the DM542S motor drivers. Connect the driver `PUL-` and `DIR-` pins to the Jetson's GND. Connect the four motor wires (A+, A-, B+, B-) from each NEMA 23 to its corresponding driver.</p>
                    </li>
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content2_step3_title">3. Firing & Vision Connections</h4>
                        <p class="text-gray-600" data-lang-key="build_content2_step3_desc">Wire the 24V solenoid to a 1-channel relay. The relay's logic side (VCC, GND, IN) is controlled by a 5V signal from the Jetson. To avoid USB bandwidth limits, connect two cameras to the Jetson's USB-A ports and the other two cameras to a powered USB-C hub.</p>
                    </li>
                </ul>
            </div>

            <div id="tab-content-ai" class="tab-content hidden">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4" data-lang-key="build_content3_title">Phase 3: AI Model & Software</h3>
                <p class="mb-6 text-gray-700" data-lang-key="build_content3_desc">This phase involves creating the "brain" of the turret. A custom object detection model is trained to recognize targets and the control script integrates all hardware into one autonomous system.</p>
                <ul class="space-y-4">
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content3_step1_title">1. Build the Custom Dataset</h4>
                        <p class="text-gray-600" data-lang-key="build_content3_step1_desc">Gather thousands of images for three classes: `formosan_macaque`, `muntjac`, and `human`. The 'human' class must be extremely diverse (poses, clothing, lighting) to ensure safety.</p>
                    </li>
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content3_step2_title">2. Annotate and Train (YOLO)</h4>
                        <p class="text-gray-600" data-lang-key="build_content3_step2_desc">Use a tool like CVAT or Roboflow to draw bounding boxes around all objects in the dataset. Train a YOLO model (using the `ultralytics` package) on this custom dataset. This "transfer learning" process fine-tunes a pre-trained model for this specific task, resulting in a `best.pt` file.</p>
                    </li>
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content3_step3_title">3. Deploy with TensorRT & Write Control Script</h4>
                        <p class="text-gray-600" data-lang-key="build_content3_step3_desc">On the Jetson, convert the `best.pt` model to a `best.engine` file using `model.export(format='engine')`. This provides a massive speedup. The final Python script uses multi-threading to read all cameras, runs inference, and implements a state machine (SAFE, TRACKING, SEARCHING) to control the PID motor loops and firing relay.</p>
                    </li>
                </ul>
            </div>

            <div id="tab-content-calibration" class="tab-content hidden">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4" data-lang-key="build_content4_title">Phase 4: Calibration & Testing</h3>
                <p class="mb-6 text-gray-700" data-lang-key="build_content4_desc">This final phase "glues" the vision system to the motion system, ensuring that what the camera sees is where the gun points. This is followed by performance tuning and critical safety checks.</p>
                <ul class="space-y-4">
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content4_step1_title">1. Intrinsic Camera Calibration</h4>
                        <p class="text-gray-600" data-lang-key="build_content4_step1_desc">For each of the four cameras, use OpenCV and a printed chessboard pattern to calculate the lens distortion. This step generates a camera matrix and distortion coefficients that are used to `cv2.undistort()` every frame, ensuring all lines are straight.</p>
                    </li>
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content4_step2_title">2. Turret-to-Camera Mapping (Homography)</h4>
                        <p class="text-gray-600" data-lang-key="build_content4_step2_desc">This is the most critical step. Mount a laser pointer on the gun. Write a script to move the turret to a grid of known angles. At each point, record the laser dot's `(pixel_x, pixel_y)` coordinate. This creates a dataset mapping angles to pixels, which is used to compute a transformation matrix. This matrix allows the code to instantly convert a target's pixel location into the motor angles needed to aim at it.</p>
                    </li>
                    <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-lg" data-lang-key="build_content4_step3_title">3. PID Tuning & Field Testing</h4>
                        <p class="text-gray-600" data-lang-key="build_content4_step3_desc">In a safe area, tune the `kP`, `kI`, and `kD` gains for the pan and tilt PID controllers. This ensures the tracking is fast, smooth, and does not overshoot the target. Start with P, then D, then I.</p>
                    </li>
                </ul>
            </div>
        </section>

        <section id="safety" class="content-section bg-red-100 border-t-4 border-red-500">
            <h2 class="text-3xl font-bold text-center text-red-800 mb-8" data-lang-key="safety_title">Safety & Ethical Protocols</h2>
            <p class="text-lg text-red-700 text-center max-w-3xl mx-auto mb-12" data-lang-key="safety_subtitle">Safety is the highest priority. This system is an autonomous tool, and its development and operation carry significant responsibility. These protocols are mandatory and non-negotiable.</p>
            <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-xl p-8">
                <ul class="space-y-6">
                    <li class="flex items-start">
                        <span class="text-3xl mr-4 text-red-600" role="img" aria-label="stop button">🛑</span>
                        <div>
                            <h4 class="text-xl font-semibold text-red-800" data-lang-key="safety_item1_title">Physical E-Stop</h4>
                            <p class="text-gray-700" data-lang-key="safety_item1_desc">A large, red, physical "Emergency Stop" button must be wired to cut all power to the motors and firing solenoid, providing a foolproof hardware-level override.</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-3xl mr-4 text-red-600" role="img" aria-label="shield">🛡️</span>
                        <div>
                            <h4 class="text-xl font-semibold text-red-800" data-lang-key="safety_item2_title">Robust Human Detection</h4>
                            <p class="text-gray-700" data-lang-key="safety_item2_desc">The "Safe Mode" is the primary software defense. The confidence threshold for human detection must be set conservatively low (e.g., 0.3) to prioritize avoiding false negatives (failing to see a human) over false positives.</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-3xl mr-4 text-red-600" role="img"aria-label="map">🗺️</span>
                        <div>
                            <h4 class="text-xl font-semibold text-red-800" data-lang-key="safety_item3_title">Geofencing</h4>
                            <p class="text-gray-700" data-lang-key="safety_item3_desc">The turret's operational range must be programmatically limited to prevent it from aiming or firing outside the designated protected area.</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-3xl mr-4 text-red-600" role="img" aria-label="person watching">👀</span>
                        <div>
                            <h4 class="text-xl font-semibold text-red-800" data-lang-key="safety_item4_title">Supervised Operation</h4>
                            <p class="text-gray-700" data-lang-key="safety_item4_desc">The system must never be left completely unattended. A human operator must always be present and able to intervene using the E-Stop.</p>
                        </div>
                    </li>
                </ul>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-gray-300 mt-16 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p data-lang-key="footer_copyright">&copy; 2025 AI Turret Project Explorer.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- TRANSLATION SCRIPT ---
            const translations = {
                'en': {
                    'page_title': 'AI Pest Repellent Turret | Project Explorer',
                    'lang_btn_text': 'EN',
                    'lang_btn_title': 'Language',
                    'nav_title': 'AI Turret Explorer',
                    'nav_home': 'Home',
                    'nav_3d': '3D Turret View',
                    'nav_overview': 'System Overview',
                    'nav_components': 'Components',
                    'nav_build': 'Build Guides',
                    'nav_safety': 'Safety',
                    'home_title': 'AI-Powered Autonomous Turret',
                    'home_subtitle': 'An interactive guide to the construction and programming of an intelligent, non-lethal wildlife deterrent. This system is designed to identify and discourage specific animals from protected areas while actively detecting and avoiding human presence.',
                    'home_explore_btn': 'Explore the System',
                    'home_target1_title': 'Target: Macaque',
                    'home_target1_desc': "Formosan Macaque (*Macaca cyclopis*)",
                    'home_target2_title': 'Target: Muntjac',
                    'home_target2_desc': "Reeves's Muntjac (*Muntiacus reevesi*)",
                    'home_avoid_title': 'Avoid: Human',
                    'home_avoid_desc': 'System enters safe mode on human detection.',
                    '3d_title': 'Interactive 3D Turret View',
                    '3d_subtitle': 'Explore the AI Turret from every angle! Use your mouse/finger to rotate, pan, and zoom the model. This interactive view allows you to inspect the mechanical and electronic components in detail.',
                    '3d_note1': '<strong>Note:</strong> This is an interactive 3D model viewer. It is currently displaying a placeholder "Astronaut" model.',
                    '3d_note2': 'To show your own model, replace the `src` URL in the HTML with a public link to your own `.glb` or `.gltf` file.',
                    'overview_title': 'System Architecture',
                    'overview_subtitle': 'The turret operates on a classic "Perception-Decision-Actuation" loop. This model explains how the components work together in real-time. Click a cloud to learn more about its function and key components.',
                    'overview_btn1_title': '1. Perception',
                    'overview_btn1_desc': 'Sensing the environment.',
                    'overview_btn2_title': '2. Decision',
                    'overview_btn2_desc': 'Analyzing and planning.',
                    'overview_btn3_title': '3. Actuation',
                    'overview_btn3_desc': 'Taking physical action.',
                    'overview_content1_title': 'Perception: The 360° Vision System',
                    'overview_content1_desc': 'The system perceives its environment using a quad-camera array (4x Logitech C615 webcams) providing a seamless 360-degree panoramic view. This continuous stream of visual data is the primary sensory input, fed directly to the AI model for analysis. This setup eliminates blind spots and ensures comprehensive situational awareness.',
                    'overview_content2_title': 'Decision: The AI Brain (Jetson & YOLO)',
                    'overview_content2_desc': 'The heart of the decision-making process is the NVIDIA Jetson Orin Nano. It runs a custom-trained YOLO model, processing all camera feeds in real-time. This model detects and classifies objects (macaque, muntjac, human). The control software applies a simple logic: if a human is seen, enter "Safe Mode." If a target animal is seen (and no human), calculate its position and initiate tracking.',
                    'overview_content3_title': 'Actuation: The Mechanical Response',
                    'overview_content3_desc': "Based on the AI's decision, the Jetson commands the physical hardware. It sends signals to two NEMA 23 stepper motors via DM542S drivers, which move the high-torque herringbone gear pan-tilt mechanism to aim the paintball gun. To fire, it sends a signal to a relay, which activates a 24V solenoid to pull the trigger. This entire loop repeats multiple times per second.",
                    'components_title': 'Interactive Bill of Materials',
                    'components_subtitle': 'This is the complete list of components required for the project. Use the filters to explore parts by category or use the search bar to find a specific item. A breakdown of component categories is shown in the chart.',
                    'components_chart_title': 'Component Categories',
                    'components_software_title': 'Key Software Stack',
                    'components_sw1_title': 'Operating System',
                    'components_sw1_desc': 'NVIDIA JetPack SDK (on Jetson)',
                    'components_sw1_notes': 'Includes Ubuntu, CUDA, cuDNN, and TensorRT.',
                    'components_sw2_title': 'Core Language',
                    'components_sw2_desc': 'Python 3.x',
                    'components_sw2_notes': 'For the main control script, inference, and hardware I/O.',
                    'components_sw3_title': 'AI / Object Detection',
                    'components_sw3_desc': 'Ultralytics YOLO (v11 cited, v8+ common)',
                    'components_sw3_notes': 'Used for training and running the detection model.',
                    'components_sw4_title': 'Key Libraries',
                    'components_sw4_desc': 'OpenCV, TensorRT, RPi.GPIO (or similar)',
                    'components_sw4_notes': 'For camera vision, model acceleration, and motor control.',
                    'components_search_placeholder': "Search for a component (e.g., 'Jetson', 'NEMA 23')...",
                    'build_title': 'Interactive Build Guides',
                    'build_subtitle': 'Explore the four core phases of building this AI Turret. Click on any cloud below to reveal detailed steps, challenges, and insights for that stage of development.',
                    'build_btn1_title': 'Mechanical Assembly',
                    'build_btn1_desc': 'Physical frame & motion system',
                    'build_btn2_title': 'Electronics & Wiring',
                    'build_btn2_desc': 'Power, logic & control components',
                    'build_btn3_title': 'AI Model & Software',
                    'build_btn3_desc': 'Training vision & control script',
                    'build_btn4_title': 'Calibration & Testing',
                    'build_btn4_desc': 'Aligning vision & hardware',
                    'build_content1_title': 'Phase 1: Mechanical Assembly',
                    'build_content1_desc': 'This phase involves building the physical structure and motion system. Precision and rigidity are the primary goals. The core of this phase is the high-torque herringbone gear drive, which provides backlash-free, precise aiming.',
                    'build_content1_step1_title': '1. Construct the Main Frame',
                    'build_content1_step1_desc': 'Assemble the 2020 aluminum extrusion base and gantry. Use corner brackets and T-nuts to create a rigid skeleton, ensuring all corners are perfectly square.',
                    'build_content1_step2_title': '2. Fabricate & Assemble Pan-Tilt Drive',
                    'build_content1_step2_desc': '3D print the large herringbone gears (pan and tilt) and motor pinions from PETG or ABS. Mount the pan motor inside the frame, meshing with the main ring gear which sits on a thrust bearing. Assemble the tilt gantry with its motor and gear, supported by deep groove ball bearings.',
                    'build_content1_step3_title': '3. Mount Payload & Vision System',
                    'build_content1_step3_desc': 'Secure the paintball gun in its 3D printed cradle. Install the 24V solenoid using a custom bracket, aligning it perfectly with the trigger. Mount the four webcams on the stationary base frame to create the overlapping 360° field of view.',
                    'build_content2_title': 'Phase 2: Electronics & Wiring',
                    'build_content2_desc': "This phase connects all components, distributing power and control signals. A clean, methodical wiring plan with proper grounding is essential to prevent electrical noise from interfering with the Jetson's logic signals.",
                    'build_content2_step1_title': '1. Power Distribution',
                    'build_content2_step1_desc': 'Install the 12V Mean Well PSU. Use a terminal block to distribute 12V power to the Jetson, motor drivers, and two DC-DC converters. One buck converter steps 12V down to 5V (for logic), and one boost converter steps 12V up to 24V (for the solenoid).',
                    'build_content2_step2_title': '2. Motion Control Wiring',
                    'build_content2_step2_desc': "Connect the Jetson's GPIO pins to the `PUL+` (Pulse) and `DIR+` (Direction) inputs on the DM542S motor drivers. Connect the driver `PUL-` and `DIR-` pins to the Jetson's GND. Connect the four motor wires (A+, A-, B+, B-) from each NEMA 23 to its corresponding driver.",
                    'build_content2_step3_title': '3. Firing & Vision Connections',
                    'build_content2_step3_desc': "Wire the 24V solenoid to a 1-channel relay. The relay's logic side (VCC, GND, IN) is controlled by a 5V signal from the Jetson. To avoid USB bandwidth limits, connect two cameras to the Jetson's USB-A ports and the other two cameras to a powered USB-C hub.",
                    'build_content3_title': 'Phase 3: AI Model & Software',
                    'build_content3_desc': 'This phase involves creating the "brain" of the turret. A custom object detection model is trained to recognize targets and the control script integrates all hardware into one autonomous system.',
                    'build_content3_step1_title': '1. Build the Custom Dataset',
                    'build_content3_step1_desc': "Gather thousands of images for three classes: `formosan_macaque`, `muntjac`, and `human`. The 'human' class must be extremely diverse (poses, clothing, lighting) to ensure safety.",
                    'build_content3_step2_title': '2. Annotate and Train (YOLO)',
                    'build_content3_step2_desc': 'Use a tool like CVAT or Roboflow to draw bounding boxes around all objects in the dataset. Train a YOLO model (using the `ultralytics` package) on this custom dataset. This "transfer learning" process fine-tunes a pre-trained model for this specific task, resulting in a `best.pt` file.',
                    'build_content3_step3_title': '3. Deploy with TensorRT & Write Control Script',
                    'build_content3_step3_desc': "On the Jetson, convert the `best.pt` model to a `best.engine` file using `model.export(format='engine')`. This provides a massive speedup. The final Python script uses multi-threading to read all cameras, runs inference, and implements a state machine (SAFE, TRACKING, SEARCHING) to control the PID motor loops and firing relay.",
                    'build_content4_title': 'Phase 4: Calibration & Testing',
                    'build_content4_desc': 'This final phase "glues" the vision system to the motion system, ensuring that what the camera sees is where the gun points. This is followed by performance tuning and critical safety checks.',
                    'build_content4_step1_title': '1. Intrinsic Camera Calibration',
                    'build_content4_step1_desc': 'For each of the four cameras, use OpenCV and a printed chessboard pattern to calculate the lens distortion. This step generates a camera matrix and distortion coefficients that are used to `cv2.undistort()` every frame, ensuring all lines are straight.',
                    'build_content4_step2_title': '2. Turret-to-Camera Mapping (Homography)',
                    'build_content4_step2_desc': "This is the most critical step. Mount a laser pointer on the gun. Write a script to move the turret to a grid of known angles. At each point, record the laser dot's `(pixel_x, pixel_y)` coordinate. This creates a dataset mapping angles to pixels, which is used to compute a transformation matrix. This matrix allows the code to instantly convert a target's pixel location into the motor angles needed to aim at it.",
                    'build_content4_step3_title': '3. PID Tuning & Field Testing',
                    'build_content4_step3_desc': 'In a safe area, tune the `kP`, `kI`, and `kD` gains for the pan and tilt PID controllers. This ensures the tracking is fast, smooth, and does not overshoot the target. Start with P, then D, then I.',
                    'safety_title': 'Safety & Ethical Protocols',
                    'safety_subtitle': 'Safety is the highest priority. This system is an autonomous tool, and its development and operation carry significant responsibility. These protocols are mandatory and non-negotiable.',
                    'safety_item1_title': 'Physical E-Stop',
                    'safety_item1_desc': 'A large, red, physical "Emergency Stop" button must be wired to cut all power to the motors and firing solenoid, providing a foolproof hardware-level override.',
                    'safety_item2_title': 'Robust Human Detection',
                    'safety_item2_desc': 'The "Safe Mode" is the primary software defense. The confidence threshold for human detection must be set conservatively low (e.g., 0.3) to prioritize avoiding false negatives (failing to see a human) over false positives.',
                    'safety_item3_title': 'Geofencing',
                    'safety_item3_desc': "The turret's operational range must be programmatically limited to prevent it from aiming or firing outside the designated protected area.",
                    'safety_item4_title': 'Supervised Operation',
                    'safety_item4_desc': 'The system must never be left completely unattended. A human operator must always be present and able to intervene using the E-Stop.',
                    'footer_copyright': '© 2025 AI Turret Project Explorer.'
                },
                'zh-tw': {
                    'page_title': 'AI 害蟲驅逐砲塔 | 專案瀏覽器',
                    'lang_btn_text': 'ZH-TW',
                    'lang_btn_title': '語言',
                    'nav_title': 'AI 砲塔瀏覽器',
                    'nav_home': '首頁',
                    'nav_3d': '3D 砲塔視圖',
                    'nav_overview': '系統總覽',
                    'nav_components': '組件',
                    'nav_build': '組裝指南',
                    'nav_safety': '安全',
                    'home_title': 'AI 驅動自主砲塔',
                    'home_subtitle': '一個互動指南，介紹如何建構和編程一個智能的非致命野生動物威懾系統。該系統旨在識別並阻止特定動物進入保護區，同時主動偵測並避開人類。',
                    'home_explore_btn': '探索系統',
                    'home_target1_title': '目標：獼猴',
                    'home_target1_desc': '台灣獼猴 (*Macaca cyclopis*)',
                    'home_target2_title': '目標：山羌',
                    'home_target2_desc': '羌 (*Muntiacus reevesi*)',
                    'home_avoid_title': '避開：人類',
                    'home_avoid_desc': '偵測到人類時，系統進入安全模式。',
                    '3d_title': '互動 3D 砲塔視圖',
                    '3d_subtitle': '從各個角度探索 AI 砲塔！使用您的滑鼠/手指旋轉、平移和縮放模型。此互動視圖可讓您詳細檢查機械和電子組件。',
                    '3d_note1': '<strong>注意：</strong> 這是一個互動式 3D 模型檢視器。目前顯示的是一個「太空人」佔位模型。',
                    '3d_note2': '要顯示您自己的模型，請將 HTML 中的 `src` URL 替換為您自己的 `.glb` 或 `.gltf` 檔案的公開連結。',
                    'overview_title': '系統架構',
                    'overview_subtitle': '砲塔以經典的「感知-決策-致動」循環運作。此模型解釋了組件如何即時協同工作。點擊一個雲朵以了解更多關於其功能和關鍵組件的資訊。',
                    'overview_btn1_title': '1. 感知',
                    'overview_btn1_desc': '感知環境。',
                    'overview_btn2_title': '2. 決策',
                    'overview_btn2_desc': '分析與規劃。',
                    'overview_btn3_title': '3. 致動',
                    'overview_btn3_desc': '採取實體行動。',
                    'overview_content1_title': '感知：360° 視覺系統',
                    'overview_content1_desc': '該系統使用四個攝像頭陣列（4x Logitech C615 網路攝像頭）感知環境，提供無縫的 360 度全景視圖。這種連續的視覺數據流是主要的感官輸入，直接饋送到 AI 模型進行分析。這種設置消除了盲點，確保了全面的態勢感知。',
                    'overview_content2_title': '決策：AI 大腦 (Jetson & YOLO)',
                    'overview_content2_desc': '決策過程的核心是 NVIDIA Jetson Orin Nano。它運行一個客製化訓練的 YOLO 模型，即時處理所有攝像頭反饋。該模型偵測並分類物體（獼猴、山羌、人類）。控制軟體應用簡單的邏DGIc：如果看到人類，則進入「安全模式」。如果看到目標動物（且沒有人類），則計算其位置並啟動跟踪。',
                    'overview_content3_title': '致動：機械反應',
                    'overview_content3_desc': '基於 AI 的決策，Jetson 向實體硬體下達命令。它通過 DM542S 驅動器向兩個 NEMA 23 步進電機發送信號，移動高扭矩人字齒輪平移傾斜機構以瞄準漆彈槍。要開火，它向繼電器發送信號，繼電器啟動一個 24V 電磁閥來扣動扳機。這整個循環每秒重複多次。',
                    'components_title': '互動材料清單 (BOM)',
                    'components_subtitle': '這是專案所需組件的完整列表。使用過濾器按類別瀏覽零件，或使用搜索欄查找特定項目。組件類別的分解圖顯示在圖表中。',
                    'components_chart_title': '組件類別',
                    'components_software_title': '關鍵軟體堆疊',
                    'components_sw1_title': '操作系統',
                    'components_sw1_desc': 'NVIDIA JetPack SDK (在 Jetson 上)',
                    'components_sw1_notes': '包括 Ubuntu、CUDA、cuDNN 和 TensorRT。',
                    'components_sw2_title': '核心語言',
                    'components_sw2_desc': 'Python 3.x',
                    'components_sw2_notes': '用於主控制腳本、推論和硬體 I/O。',
                    'components_sw3_title': 'AI / 物件偵測',
                    'components_sw3_desc': 'Ultralytics YOLO (引用 v11，常用 v8+)',
                    'components_sw3_notes': '用於訓練和運行偵測模型。',
                    'components_sw4_title': '關鍵函式庫',
                    'components_sw4_desc': 'OpenCV, TensorRT, RPi.GPIO (或類似)',
                    'components_sw4_notes': '用於相機視覺、模型加速和馬達控制。',
                    'components_search_placeholder': '搜索組件（例如 "Jetson", "NEMA 23"）...',
                    'build_title': '互動組裝指南',
                    'build_subtitle': '探索建造這座 AI 砲塔的四個核心階段。點擊下方的任一雲朵，查看該開發階段的詳細步驟、挑戰和見解。',
                    'build_btn1_title': '機械組裝',
                    'build_btn1_desc': '實體框架與運動系統',
                    'build_btn2_title': '電子與佈線',
                    'build_btn2_desc': '電源、邏輯與控制組件',
                    'build_btn3_title': 'AI 模型與軟體',
                    'build_btn3_desc': '訓練視覺與控制腳Bben',
                    'build_btn4_title': '校準與測試',
                    'build_btn4_desc': '對齊視覺與硬體',
                    'build_content1_title': '階段 1：機械組裝',
                    'build_content1_desc': '此階段涉及建造實體結構和運動系統。精確度和剛性是主要目標。此階段的核心是高扭矩人字齒輪驅動器，它提供無背隙的精確瞄準。',
                    'build_content1_step1_title': '1. 建構主框架',
                    'build_content1_step1_desc': '組裝 2020 鋁擠型材底座和龍門架。使用角碼和 T 型螺母創建一個剛性骨架，確保所有角落都完全呈直角。',
                    'build_content1_step2_title': '2. 製作與組裝平移傾斜驅動器',
                    'build_content1_step2_desc': '使用 PETG 或 ABS 3D 列印大型人字齒輪（平移和傾斜）和馬達小齒輪。將平移馬達安裝在框架內，與位於推力軸承上的主環齒輪meshing。組裝傾斜龍門架及其馬達和齒輪，由深溝球軸承支撐。',
                    'build_content1_step3_title': '3. 安裝有效載荷與視覺系統',
                    'build_content1_step3_desc': '將漆彈槍固定在其 3D 列印的托架中。使用客製化支架安裝 24V 電磁閥，使其與扳機完美對齊。將四個網路攝像頭安裝在固定的底座框架上，以創建重疊的 360° 視野。',
                    'build_content2_title': '階段 2：電子與佈線',
                    'build_content2_desc': '此階段連接所有組件，分配電源和控制信號。一個乾淨、有條理的佈線計劃和適當的接地對於防止電噪聲干擾 Jetson 的邏GIC信號至關重要。',
                    'build_content2_step1_title': '1. 電源分配',
                    'build_content2_step1_desc': '安裝 12V 明緯電源供應器。使用端子台將 12V 電源分配給 Jetson、馬達驅動器和兩個 DC-DC 轉換器。一個降壓轉換器將 12V 降至 5V（用於邏輯），一個升壓轉換器將 12V 升至 24V（用於電磁閥）。',
                    'build_content2_step2_title': '2. 運動控制佈線',
                    'build_content2_step2_desc': '將 Jetson 的 GPIO 引腳連接到 DM542S 馬達驅動器上的 `PUL+`（脈衝）和 `DIR+`（方向）輸入端。將驅動器的 `PUL-` 和 `DIR-` 引腳連接到 Jetson 的 GND。將每個 NEMA 23 的四根馬達線（A+, A-, B+, B-）連接到其相應的驅動器。',
                    'build_content2_step3_title': '3. 點火與視覺連接',
                    'build_content2_step3_desc': '將 24V 電磁閥連接到 1 通道繼電器。繼電器的邏輯端（VCC, GND, IN）由來自 Jetson 的 5V 信號控制。為避免 USB 帶寬限制，將兩個攝像頭連接到 Jetson 的 USB-A 端口，另外兩個攝像頭連接到一個有源 USB-C 集線器。',
                    'build_content3_title': '階段 3：AI 模型與軟體',
                    'build_content3_desc': '此階段涉及創建砲塔的「大腦」。訓練一個客製化物件偵測模型以識別目標，並編寫控制腳本將所有硬體整合為一個自主系統。',
                    'build_content3_step1_title': '1. 建立客製化數據集',
                    'build_content3_step1_desc': '為三個類別收集數千張圖片：`formosan_macaque`、`muntjac` 和 `human`。「人類」類別必須極其多樣化（姿勢、服裝、光線），以確保安全。',
                    'build_content3_step2_title': '2. 標註與訓練 (YOLO)',
                    'build_content3_step2_desc': '使用像 CVAT 或 Roboflow 這樣的工具在數據集中的所有物體周圍繪製邊界框。在這個客製化數據集上訓練一個 YOLO 模型（使用 `ultralytics` 套件）。這個「遷移學習」過程微調了一個預訓練模型以適應這個特定任務，最終產生一個 `best.pt` 檔案。',
                    'build_content3_step3_title': '3. 使用 TensorRT 部署並編寫控制腳本',
                    'build_content3_step3_desc': '在 Jetson 上，使用 `model.export(format=\'engine\')` 將 `best.pt` 模型轉換為 `best.engine` 檔案。這提供了巨大的速度提升。最終的 Python 腳本使用多線程讀取所有攝像頭，運行推論，並實現一個狀態機（安全、跟踪、搜索）來控制 PID 馬達循環和點火繼電器。',
                    'build_content4_title': '階段 4：校準與測試',
                    'build_content4_desc': '這最後一個階段將視覺系統與運動系統「黏合」在一起，確保攝像頭看到的A就是槍所指向的地方。隨後是性能調優和關鍵的安全檢查。',
                    'build_content4_step1_title': '1. 相機內部校準',
                    'build_content4_step1_desc': '對於四個攝像頭中的每一個，使用 OpenCV 和一個列印的棋盤格圖案來計算鏡頭畸變。此步驟生成一個相機矩陣和畸變係數，用於對每一幀進行 `cv2.undistort()`，確保所有線條都是直的。',
                    'build_content4_step2_title': '2. 砲塔至相機映射 (單應性)',
                    'build_content4_step2_desc': '這是最關鍵的步驟。在槍上安裝一個激光筆。編寫一個腳本，將砲塔移動到一個已知角度的網格。在每個點上，記錄激光點的 `(pixel_x, pixel_y)` 座標。這會創建一個映射角度到像素的數據集，用於計算一個變換矩陣。這個矩陣允許代碼立即將目標的像素位置轉換為瞄準它所需的馬達角度。',
                    'build_content4_step3_title': '3. PID 調優與現場測試',
                    'build_content4_step3_desc': '在一個安全的區域，為平移和傾斜 PID 控制器調優 `kP`、`kI` 和 `kD` 增益。這確保了跟踪是快速、平滑的，並且不會超過目標。從 P 開始，然後是 D，最後是 I。',
                    'safety_title': '安全與倫理協議',
                    'safety_subtitle': '安全是最高優先級。本系統是一個自主工具，其開發和運營帶有重大責任。這些協議是強制性的且不可協商的。',
                    'safety_item1_title': '實體緊急停止按鈕',
                    'safety_item1_desc': '必須接線一個大型、紅色、實體的「緊急停止」按鈕，以切斷馬達和點火電磁閥的所有電源，提供一個萬無一失的硬體級別覆蓋。',
                    'safety_item2_title': '強大的人類偵測',
                    'safety_item2_desc': '「安全模式」是主要的軟體防禦。人類偵測的信心閾值必須保守地設置得很低（例如 0.3），以優先避免假陰性（未能看到人類）而不是假陽性。',
                    'safety_item3_title': '地理圍欄',
                    'safety_item3_desc': '砲塔的操作範圍必須受到程序化限制，以防止其瞄準或射擊到指定的保護區域之外。',
                    'safety_item4_title': '監督下操作',
                    'safety_item4_desc': '系統絕不能完全無人看管。必須始終有一名操作員在場，並能使用緊急停止按鈕進行干預。',
                    'footer_copyright': '© 2025 AI 砲塔專案瀏覽器。'
                }
            };

            const langToggleButton = document.getElementById('lang-toggle-btn');
            const langBtnText = document.getElementById('lang-btn-text');
            const langDropdown = document.getElementById('lang-dropdown');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');

            function setLanguage(lang) {
                document.documentElement.lang = lang;
                document.getElementById('page-title').textContent = translations[lang]['page_title'];
                
                const elements = document.querySelectorAll('[data-lang-key]');
                elements.forEach(el => {
                    const key = el.dataset.langKey;
                    if (translations[lang][key]) {
                        el.innerHTML = translations[lang][key];
                    }
                });

                // Update search placeholder
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.placeholder = translations[lang]['components_search_placeholder'];
                }
                
                // Update main lang button text
                if (langBtnText) {
                    langBtnText.textContent = translations[lang]['lang_btn_text'];
                }

                // Close dropdowns
                if (langDropdown) langDropdown.classList.add('hidden');
                if (mobileMenu) mobileMenu.classList.add('hidden');
                // Update mobile menu icons
                if (mobileMenuBtn) {
                    const hamburgerIcon = mobileMenuBtn.querySelector('svg:nth-of-type(1)');
                    const closeIcon = mobileMenuBtn.querySelector('svg:nth-of-type(2)');
                    if (hamburgerIcon) {
                        hamburgerIcon.classList.remove('hidden');
                        hamburgerIcon.classList.add('block');
                    }
                    if (closeIcon) {
                        closeIcon.classList.add('hidden');
                        closeIcon.classList.remove('block');
                    }
                }
            }

            // Language Dropdown Toggle
            if (langToggleButton) {
                langToggleButton.addEventListener('click', () => {
                    langDropdown.classList.toggle('hidden');
                });
            }

            // Language Selection (from dropdown or mobile menu)
            document.querySelectorAll('[data-lang]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    setLanguage(e.currentTarget.dataset.lang);
                });
            });

            // Mobile Menu Toggle
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    const isOpen = mobileMenu.classList.toggle('hidden'); // true if hidden, false if open
                    const hamburgerIcon = mobileMenuBtn.querySelector('svg:nth-of-type(1)');
                    const closeIcon = mobileMenuBtn.querySelector('svg:nth-of-type(2)');
                    
                    if (hamburgerIcon) {
                        hamburgerIcon.classList.toggle('hidden', !isOpen); // Hide hamburger if open
                        hamburgerIcon.classList.toggle('block', isOpen);  // Show hamburger if hidden
                    }
                    if (closeIcon) {
                        closeIcon.classList.toggle('hidden', isOpen);  // Show close if open
                        closeIcon.classList.toggle('block', !isOpen); // Hide close if hidden
                    }
                });
            }

            // Close mobile menu when a link is clicked
            document.querySelectorAll('#mobile-menu a').forEach(link => {
                if(link.href.includes('#')) {
                    link.addEventListener('click', () => {
                        mobileMenu.classList.add('hidden');
                        const hamburgerIcon = mobileMenuBtn.querySelector('svg:nth-of-type(1)');
                        const closeIcon = mobileMenuBtn.querySelector('svg:nth-of-type(2)');
                        if (hamburgerIcon) {
                            hamburgerIcon.classList.remove('hidden');
                            hamburgerIcon.classList.add('block');
                        }
                        if (closeIcon) {
                            closeIcon.classList.add('hidden');
                            closeIcon.classList.remove('block');
                        }
                    });
                }
            });

            // Set initial language
            setLanguage('en'); 
            // --- END TRANSLATION SCRIPT ---


            const allComponents = [
                { category: 'Computing', name: 'Jetson Orin Nano Dev Kit', spec: '-', qty: 1, role: 'Central processing unit for AI inference and system control.' },
                { category: 'Structure', name: '2020 Aluminum Extrusion', spec: '45 cm', qty: 12, role: 'Forms the primary structural frame.' },
                { category: 'Structure', name: '2020 Aluminum Extrusion', spec: '100 cm', qty: 12, role: 'Forms the primary structural frame.' },
                { category: 'Structure', name: '2020 Corner Brackets', spec: '90-degree', qty: 40, role: 'Connects extrusions to form rigid frame corners.' },
                { category: 'Structure', name: 'M5 T-Nuts', spec: 'For 2020', qty: 100, role: 'Provides threaded mounting points in extrusion slots.' },
                { category: 'Structure', name: 'M5 Button Head Cap Screws', spec: '8 mm', qty: 100, role: 'Fastens components to T-nuts.' },
                { category: 'Motion', name: 'NEMA 23 Stepper Motor', spec: 'High Torque (>2 N·m)', qty: 2, role: 'Provides rotational force for pan and tilt axes.' },
                { category: 'Motion', name: 'Microstep Driver', spec: 'DM542S', qty: 2, role: 'Controls the current and stepping of the NEMA 23 motors.' },
                { category: 'Motion', name: 'NEMA 23 Mounting Plate', spec: '60x90 mm', qty: 2, role: 'Securely mounts the stepper motors to the frame.' },
                { category: 'Motion', name: 'Large Herringbone Ring Gear', spec: '3D Printed, ~200mm OD', qty: 1, role: 'Pan axis main gear for high torque and precision.' },
                { category: 'Motion', name: 'Large Herringbone Tilt Gear', spec: '3D Printed, ~120mm OD', qty: 1, role: 'Tilt axis main gear.' },
                { category: 'Motion', name: 'Motor Pinion Gear', spec: '3D Printed', qty: 2, role: 'Small gear attached to the motor shaft.' },
                { category: 'Motion', name: 'Thrust Bearing', spec: 'e.g., 51110 (50mm ID)', qty: 1, role: 'Supports the axial load of the rotating turret.' },
                { category: 'Motion', name: 'Deep Groove Ball Bearings', spec: 'e.g., 6806-2RS (30mm ID)', qty: 2, role: 'Supports the tilt axis shaft for smooth rotation.' },
                { category: 'Payload', name: 'Paintball Gun', spec: 'Valken Razorback', qty: 1, role: 'The projectile delivery system.' },
                { category: 'Payload', name: 'Push-Pull Solenoid', spec: 'DC 24V, 35mm stroke', qty: 1, role: 'Actuates the trigger mechanism.' },
                { category: 'Payload', name: 'Solenoid Mounting Bracket', spec: 'Custom 3D Printed', qty: 1, role: 'Holds the solenoid in a precise position.' },
                { category: 'Vision', name: 'Webcam', spec: 'Logitech C615', qty: 4, role: 'Provides 360-degree video input.' },
                { category: 'Vision', name: 'USB-C to USB-A Hub', spec: '4-port, powered', qty: 1, role: 'Bypasses bandwidth limitations on the main USB hub.' },
                { category: 'Vision', name: 'Camera Mounts', spec: 'Custom 3D Printed', qty: 4, role: 'Positions cameras on the frame.' },
                { category: 'Power', name: 'Switching Power Supply', spec: 'Mean Well LRS-150-12', qty: 1, role: 'Provides main 12V DC power from AC.' },
                { category: 'Power', name: 'DC-DC Buck Converter', spec: 'LM2596', qty: 1, role: 'Steps down 12V to 5V for logic.' },
                { category: 'Power', name: 'DC-DC Boost Converter', spec: 'XL6009', qty: 1, role: 'Steps up 12V to 24V for the solenoid.' },
                { category: 'Power', name: 'AC Power Cord', spec: '3-prong, grounded', qty: 1, role: 'Connects the PSU to mains power.' },
                { category: 'Control', name: 'ESP32 Dev Board', spec: 'Optional', qty: 1, role: 'Optional secondary controller or GPIO expander.' },
                { category: 'Control', name: 'Relay Module', spec: '1-channel, 5V logic', qty: 1, role: 'Switches the 24V power to the solenoid.' },
                { category: 'Control', name: 'Terminal Block Connectors', spec: 'Screw terminals', qty: 1, role: 'Facilitates clean power and signal distribution.' },
                { category: 'Control', name: 'Jumper Wires & Hookup Wire', spec: '18-22 AWG', qty: 1, role: 'For all electrical connections.' }
            ];

            let activeCategory = 'All';
            let searchTerm = '';

            const componentGrid = document.getElementById('component-grid');
            const categoryFilters = document.getElementById('category-filters');
            const searchInput = document.getElementById('searchInput');

            function renderComponents() {
                if (!componentGrid) return;
                const filtered = allComponents.filter(item => {
                    const inCategory = activeCategory === 'All' || item.category === activeCategory;
                    const inSearch = searchTerm === '' || item.name.toLowerCase().includes(searchTerm) || item.role.toLowerCase().includes(searchTerm);
                    return inCategory && inSearch;
                });

                if (filtered.length === 0) {
                    componentGrid.innerHTML = `<p class="text-gray-600 col-span-1 md:col-span-2 text-center">No components match your criteria.</p>`;
                    return;
                }

                componentGrid.innerHTML = filtered.map(item => `
                    <div class="component-card">
                        <div class="p-5">
                            <div class="flex justify-between items-start">
                                <h4 class="text-lg font-semibold text-blue-800">${item.name}</h4>
                                <span class="text-xs font-bold text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${item.category}</span>
                            </div>
                            <p class="text-sm text-gray-500 mb-2">Spec: ${item.spec} (Qty: ${item.qty})</p>
                            <p class="text-sm text-gray-700">${item.role}</p>
                        </div>
                    </div>
                `).join('');
            }

            function initCategories() {
                if (!categoryFilters) return;
                const categories = ['All', ...new Set(allComponents.map(item => item.category))];
                categoryFilters.innerHTML = categories.map(category => `
                    <button class="category-button ${category === 'All' ? 'active' : ''}" data-category="${category}">
                        ${category}
                    </button>
                `).join('');

                categoryFilters.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        activeCategory = e.target.dataset.category;
                        document.querySelectorAll('#category-filters .category-button').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        e.target.classList.add('active');
                        renderComponents();
                    }
                });
            }

            if (searchInput) {
                searchInput.addEventListener('keyup', (e) => {
                    searchTerm = e.target.value.toLowerCase();
                    renderComponents();
                });
            }

            initCategories();
            renderComponents();

            const overviewButtons = {
                perception: document.getElementById('btn-perception'),
                decision: document.getElementById('btn-decision'),
                actuation: document.getElementById('btn-actuation')
            };
            const overviewContents = {
                perception: document.getElementById('content-perception'),
                decision: document.getElementById('content-decision'),
                actuation: document.getElementById('content-actuation')
            };
            const overviewCloudWrappers = document.querySelectorAll('.overview-cloud-wrapper');


            function handleOverviewClick(event) {
                const wrapper = event.currentTarget;
                const section = wrapper.dataset.overview;

                const clickedButton = overviewButtons[section];
                const clickedContent = overviewContents[section];

                if (!clickedButton || !clickedContent) return;

                const isAlreadyActive = clickedButton.classList.contains('active');

                // Hide all content and deactivate all buttons
                Object.values(overviewContents).forEach(el => el.classList.add('hidden'));
                Object.values(overviewButtons).forEach(el => el.classList.remove('active'));
                overviewCloudWrappers.forEach(el => {
                    el.classList.remove('active');
                    el.style.animationPlayState = 'running'; // Resume floating
                });

                if (!isAlreadyActive) {
                    clickedButton.classList.add('active');
                    clickedContent.classList.remove('hidden');
                    wrapper.classList.add('active'); // Add active to wrapper
                    wrapper.style.animationPlayState = 'paused'; // Pause floating
                    wrapper.style.transform = 'translateY(0px) scale(1.08)'; // Keep it scaled
                }
            }
            
            overviewCloudWrappers.forEach(wrapper => {
                wrapper.addEventListener('click', handleOverviewClick);
            });

            // Adjusted tab button logic for the new cloud-button-wrapper
            const tabButtons = {
                mechanical: document.getElementById('tab-btn-mechanical'),
                electronics: document.getElementById('tab-btn-electronics'),
                ai: document.getElementById('tab-btn-ai'),
                calibration: document.getElementById('tab-btn-calibration')
            };
            const tabContents = {
                mechanical: document.getElementById('tab-content-mechanical'),
                electronics: document.getElementById('tab-content-electronics'),
                ai: document.getElementById('tab-content-ai'),
                calibration: document.getElementById('tab-content-calibration')
            };

            const cloudWrappers = document.querySelectorAll('.cloud-button-wrapper[data-tab]');

            function handleCloudClick(event) {
                const wrapper = event.currentTarget; // The div with class .cloud-button-wrapper
                const tabName = wrapper.dataset.tab; // Get the tab name from the data-tab attribute

                const clickedButton = tabButtons[tabName];
                const clickedContent = tabContents[tabName];

                if (!clickedButton || !clickedContent) return;

                const isAlreadyActive = clickedButton.classList.contains('active');

                // Hide all content and deactivate all buttons
                Object.values(tabContents).forEach(el => el.classList.add('hidden'));
                Object.values(tabButtons).forEach(el => el.classList.remove('active'));
                cloudWrappers.forEach(el => {
                    el.querySelector('.cloud-button')?.classList.remove('active');
                    el.style.animationPlayState = 'running'; // Resume floating for all
                });


                if (!isAlreadyActive) {
                    clickedButton.classList.add('active');
                    clickedContent.classList.remove('hidden');
                    wrapper.style.animationPlayState = 'paused'; // Pause floating for active
                    wrapper.style.transform = 'translateY(0px) scale(1.08)'; // Keep it slightly scaled up and no float
                }
            }

            cloudWrappers.forEach(wrapper => {
                wrapper.addEventListener('click', handleCloudClick);
            });


            document.querySelectorAll('a.nav-link[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelectorAll('a.nav-link').forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                    
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
            
            const bomCtx = document.getElementById('bomChart')?.getContext('2d');
            if (bomCtx) {
                const categoryCounts = allComponents.reduce((acc, item) => {
                    acc[item.category] = (acc[item.category] || 0) + 1;
                    return acc;
                }, {});
                
                new Chart(bomCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(categoryCounts),
                        datasets: [{
                            label: 'Component Categories',
                            data: Object.values(categoryCounts),
                            backgroundColor: [
                                '#0077b6',
                                '#00b4d8',
                                '#90e0ef',
                                '#343a40',
                                '#6c757d',
                                '#adb5bd',
                                '#ced4da',
                                '#ffb703'
                            ],
                            borderColor: '#f8f7f4',
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: '#343a40',
                                    font: {
                                        family: 'Inter'
                                    }
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>

